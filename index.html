<!doctype html>
<html>
<style type="text/css">

h1, form
{
	text-align: center;
}

/*table 
{
	font-family: arial, sans-serif;
	border-collapse: collapse;
}

td, th 
{
	border: 1px solid #dddddd;
	text-align: left;
	padding: 8px;
}*/

table {
  border-collapse: collapse;
  margin: auto;
  /*width: 100%;*/
}

th, td {
  padding: 8px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

tr:hover {background-color:#f5f5f5;}

th
{
	background-color: white !important;
}

th:hover
{
	cursor: pointer;
}

/*tr:nth-child(even) 
{
	background-color: #eeeeee;
}*/

.chart
{
	margin: auto;
	width: 500px;
	height: 300px;
	margin-bottom: 30px;
	display: inline-block;
}

</style>
<head>
	<title>Live Corona Stats</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link href="https://fonts.googleapis.com/css?family=Manrope:200,400,700,800&display=swap" rel="stylesheet">
	<meta charset="utf-8"/>
	<script>

		function getData() 
		{
 			request = new XMLHttpRequest();
			request.open("GET", "https://covidtracking.com/api/states/daily");
			request.onreadystatechange = function() 
			{
				if (request.readyState == 4 && request.status == 200) 
				{
					result = request.responseText;
					data = JSON.parse(result);

					text = "<table id='table'><tr><th><input onchange='update_all_checkboxes()' type='checkbox' name='row'/></th><th onClick='sortBy(1)'>&#9660; State</th><th onClick='sortBy(2)'>&#9661; Total Positive Cases</th><th onClick='sortBy(3)'>&#9661; Daily Positive Increase</th><th onClick='sortBy(4)'>&#9661; Total Deaths</th><th onClick='sortBy(5)'>&#9661; Daily Death Increase</th></tr>";

					for (i = 0; i < 56; i++) 
					{
						if (data[i]["state"] !== "AS") {
							text += "<tr><td><input onchange='update_chart()' type='checkbox' name='row'/></td><td>" + data[i]["state"] + "</td><td>" + data[i]["positive"] + "</td><td>" + data[i]["positiveIncrease"] + "</td><td>" + data[i]["death"] + "</td><td>" + data[i]["deathIncrease"] + "</td></tr>";
						}

					}

					text += "</table>";

					document.getElementById("data").innerHTML = text;

				}
			}

			request.send();

			anychart.onDocumentReady(function()
	        {
			    var data = {
			      	rows: []
		           };

				var chart = anychart.column();
				chart.normal().fill("#425957");
				
				chart.data(data);

				chart.title("Selected states below to see them here.");

				chart.container("container");
				chart.draw();

				var chart2 = anychart.column();
				chart2.container("container2");
				chart2.data(data);
				chart2.title("Selected states below to see them here.");
				chart2.draw();
			});
		}

		function update_all_checkboxes()
		{
			table = document.getElementById("table");
			rows = table.rows;

			value = rows[0].getElementsByTagName("TH")[0].getElementsByTagName("input")[0].checked;
			
			for (i = 1; i < rows.length; i++) 
			{
				rows[i].getElementsByTagName("TD")[0].getElementsByTagName("input")[0].checked = value;
			}

			update_chart();
		}
		
		var sorted_by_index = 1;
		var descending = true;

		function sortBy(index)
		{
			var table, rows, switching, i, x, y, shouldSwitch;
			table = document.getElementById("table");
			switching = true;

			if (index == sorted_by_index) descending = !descending;
			else descending = true;

			fix_table(sorted_by_index, index);
			sorted_by_index = index;

			while (switching) 
			{
				switching = false;
				rows = table.rows;

				for (i = 1; i < (rows.length - 1); i++) 
				{
					shouldSwitch = false;

					x = rows[i].getElementsByTagName("TD")[sorted_by_index].innerHTML;
					y = rows[i + 1].getElementsByTagName("TD")[sorted_by_index].innerHTML;

					if (sorted_by_index == 1)
					{
						if (descending) comparison = x > y;
						else comparison = x < y;
					}
					else
					{
						x = parseInt(x);
						y = parseInt(y);
						if (descending) comparison = x < y;
						else comparison = x > y;
					}

					if (comparison)
					{
						shouldSwitch = true;
						break;
					}
					
				}
				if (shouldSwitch) 
				{
					rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
					switching = true;
				}
			}	 
		}

		function fix_table(old_i, new_i)
		{
			old_str = document.getElementById("table").rows[0].getElementsByTagName("TH")[old_i].innerHTML;

			if (old_i == new_i)
			{
				if (descending) document.getElementById("table").rows[0].getElementsByTagName("TH")[old_i].innerHTML = "&#9660;" + old_str.substring(1);
				else document.getElementById("table").rows[0].getElementsByTagName("TH")[old_i].innerHTML = "&#9650;" + old_str.substring(1);
			}
			else
			{
				new_str = document.getElementById("table").rows[0].getElementsByTagName("TH")[new_i].innerHTML;

				document.getElementById("table").rows[0].getElementsByTagName("TH")[old_i].innerHTML = "&#9661;" + old_str.substring(1);
				document.getElementById("table").rows[0].getElementsByTagName("TH")[new_i].innerHTML = "&#9660;" + new_str.substring(1);
			}
			
		}
	

	</script>
</head>
<body onload="getData()">
	<h1>Corona Tracker</h1>
	<!-- <h3 style="margin-bottom: 5px">Graph: </h3> -->
	<form style="margin-bottom:20px">
		<select id="sort" onchange="update_chart()">
			<option>Total Positive Cases</option>
			<option>Daily Positive Case Increase</option>
			<option>Total Deaths</option>
			<option>Daily Death Increase</option>
		</select>
	</form>

	<script src="https://cdn.anychart.com/releases/8.0.0/js/anychart-base.min.js"></script>
	<div class=chart id="container"></div>
	<div class=chart id="container2"></div>

	<div id="blah"></div>

	<div id="data"></div>

	<!-- map display
	<iframe src="https://createaclickablemap.com/map.php?&id=90766&maplocation=false&online=true" width="900" height="525" style="border: none;"></iframe> -->

	<script>
		function update_chart()
		{
			arr = [];
			document.getElementById("container").innerHTML = "";
			table = document.getElementById("table");
			rows = table.rows;
			dropdown = document.getElementById("sort");

			for (i = 1; i < rows.length; i++) 
			{
				if (rows[i].getElementsByTagName("TD")[0].getElementsByTagName("input")[0].checked)
				{
					// gets total positive cases only
					state_name = rows[i].getElementsByTagName("TD")[1].innerHTML;
					stat = parseInt(rows[i].getElementsByTagName("TD")[dropdown.selectedIndex+2].innerHTML);
					arr.push ([state_name, stat]);
				}
			}

	        anychart.onDocumentReady(function() 
	        {
			    // set the data
			    var data = {
			    	// header: ["Name", "Death toll"],
			      	rows: arr
		           };

				// create the chart
				var chart = anychart.column();
				chart.normal().fill("#425957");
				
				// add data
				chart.data(data);

				// set the chart title
				selected = dropdown.options[dropdown.selectedIndex].value;
				chart.title(selected + " in Selected States");
				chart.xAxis().title("States");
    			chart.yAxis().title(selected);

				// draw
				chart.container("container");
				chart.draw();
			});
	    }
    </script>


	<!-- map script
	 <script>if (window.addEventListener){ window.addEventListener("message", function(event) { if(event.data.length >= 22) { if( event.data.substr(0, 22) == "__MM-LOCATION.REDIRECT") location = event.data.substr(22); } }, false); } else if (window.attachEvent){ window.attachEvent("message", function(event) { if( event.data.length >= 22) { if ( event.data.substr(0, 22) == "__MM-LOCATION.REDIRECT") location = event.data.substr(22); } }, false); } </script> -->



</body>
</html>