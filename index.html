<!doctype html>
<html>
<style type="text/css">

</style>
<head>
	<title>COVID-19 Live Statistics</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="julia_temp_style.css">
	<link href="https://fonts.googleapis.com/css?family=Manrope:200,400,700,800&display=swap" rel="stylesheet">
	<meta charset="utf-8"/>
	<script>

		var history_arr = [];
		var colors = ["#f6c55f", "#147d9b", "#a5d1ec", "#e47d50"];

		function getData() 
		{
 			request = new XMLHttpRequest();
			request.open("GET", "https://covidtracking.com/api/states/daily");
			request.onreadystatechange = function() 
			{
				if (request.readyState == 4 && request.status == 200) 
				{
					result = request.responseText;
					data = JSON.parse(result);

					text = "<table id='table'><tr><th><input onchange='update_all_checkboxes()' type='checkbox' name='row'/></th><th onClick='sortBy(1)'>&#9660; State</th><th onClick='sortBy(2)'>&#9661; Total Positive Cases</th><th onClick='sortBy(3)'>&#9661; Daily Positive Increase</th><th onClick='sortBy(4)'>&#9661; Total Deaths</th><th onClick='sortBy(5)'>&#9661; Daily Death Increase</th></tr>";

					for (i = 0; i < 56; i++) 
					{
						if (data[i]["state"] !== "AS") {
							text += "<tr><td><input onchange='update_visuals()' type='checkbox' name='row'/></td><td>" + data[i]["state"] + "</td><td>" + data[i]["positive"] + "</td><td>" + data[i]["positiveIncrease"] + "</td><td>" + data[i]["death"] + "</td><td>" + data[i]["deathIncrease"] + "</td></tr>";
						}

					}

					text += "</table>";

					document.getElementById("data").innerHTML = text;

					history_arr["Total Positive Cases"] = set_history_array("positive", data);
					history_arr["Daily Positive Case Increase"] = set_history_array("positiveIncrease", data);
					history_arr["Total Deaths"] = set_history_array("death", data);
					history_arr["Daily Death Increase"] = set_history_array("deathIncrease", data);
				}
			}

			request.send();

			anychart.onDocumentReady(function()
	        {
				var chart = anychart.column();
				// chart.title("Selected states below to see them here.");
				var x = chart.xAxis().title();
				x.enabled(true);
				x.useHtml(true);
				x.text("<a style='color:#EB8258'>States</a>");
				var y = chart.yAxis().title();
				y.enabled(true);
				y.useHtml(true);
				y.text("<a style='color:#EB8258'>Total Positive Cases</a>");
    			chart.background().fill(null);
				chart.container("container");
				chart.draw();

				var chart2 = anychart.line();
				// chart2.title("Selected states below to see them here.");
				var x2 = chart2.xAxis().title();
				x2.enabled(true);
				x2.useHtml(true);
				x2.text("<a style='color:#EB8258'>Time</a>");
				var y2 = chart2.yAxis().title();
				y2.enabled(true);
				y2.useHtml(true);
				y2.text("<a style='color:#EB8258'>Total Positive Cases</a>")
    			chart2.background().fill(null);
    			chart2.container("container2");
				chart2.draw();
			});
		}

		function set_history_array(str, data)
		{
			var arr = new Array(55);
			var text = null;
			for (i = 0; i < 56; i++) {
				if (data[i]["state"] !== "AS"){
					arr[data[i]["state"]] = new Array(30);
					text += data[i]["state"] + ": ";
					var set = i;
					for (j = 0; j < 30; j++) {
						arr[data[i]["state"]][j] = data[set][str];
						text += data[set][str] + ", ";
						set = set + 56; 
					}
					text += "<br>";
				}
			}
			// do sth with text also?
			return arr;
		}

		function update_all_checkboxes()
		{
			table = document.getElementById("table");
			rows = table.rows;

			value = rows[0].getElementsByTagName("TH")[0].getElementsByTagName("input")[0].checked;
			
			for (i = 1; i < rows.length; i++) 
			{
				rows[i].getElementsByTagName("TD")[0].getElementsByTagName("input")[0].checked = value;
			}

			update_chart();
			update_plot();
		}
		
		var sorted_by_index = 1;
		var descending = true;

		function sortBy(index)
		{
			var table, rows, switching, i, x, y, shouldSwitch;
			table = document.getElementById("table");
			switching = true;

			if (index == sorted_by_index) descending = !descending;
			else descending = true;

			fix_table(sorted_by_index, index);
			sorted_by_index = index;

			while (switching) 
			{
				switching = false;
				rows = table.rows;

				for (i = 1; i < (rows.length - 1); i++) 
				{
					shouldSwitch = false;

					x = rows[i].getElementsByTagName("TD")[sorted_by_index].innerHTML;
					y = rows[i + 1].getElementsByTagName("TD")[sorted_by_index].innerHTML;

					if (sorted_by_index == 1)
					{
						if (descending) comparison = x > y;
						else comparison = x < y;
					}
					else
					{
						x = parseInt(x);
						y = parseInt(y);
						if (descending) comparison = x < y;
						else comparison = x > y;
					}

					if (comparison)
					{
						shouldSwitch = true;
						break;
					}
					
				}
				if (shouldSwitch) 
				{
					rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
					switching = true;
				}
			}	 
		}

		function fix_table(old_i, new_i)
		{
			old_str = document.getElementById("table").rows[0].getElementsByTagName("TH")[old_i].innerHTML;

			if (old_i == new_i)
			{
				if (descending) document.getElementById("table").rows[0].getElementsByTagName("TH")[old_i].innerHTML = "&#9660;" + old_str.substring(1);
				else document.getElementById("table").rows[0].getElementsByTagName("TH")[old_i].innerHTML = "&#9650;" + old_str.substring(1);
			}
			else
			{
				new_str = document.getElementById("table").rows[0].getElementsByTagName("TH")[new_i].innerHTML;

				document.getElementById("table").rows[0].getElementsByTagName("TH")[old_i].innerHTML = "&#9661;" + old_str.substring(1);
				document.getElementById("table").rows[0].getElementsByTagName("TH")[new_i].innerHTML = "&#9660;" + new_str.substring(1);
			}
			
		}

		function update_visuals()
		{
			update_chart();
			update_plot();
		}

		function update_chart()
		{
			arr = [];
			document.getElementById("container").innerHTML = "";
			table = document.getElementById("table");
			rows = table.rows;
			dropdown = document.getElementById("sort");

			for (i = 1; i < rows.length; i++) 
			{
				if (rows[i].getElementsByTagName("TD")[0].getElementsByTagName("input")[0].checked)
				{
					state_name = rows[i].getElementsByTagName("TD")[1].innerHTML;
					stat = parseInt(rows[i].getElementsByTagName("TD")[dropdown.selectedIndex+2].innerHTML);
					arr.push ([state_name, stat]);
				}
			}

	        anychart.onDocumentReady(function() 
	        {
	        	data = [];

	        	for (i = 0; i < arr.length; i++)
	        	{
	        		data.push({x: arr[i][0], value: arr[i][1], fill: colors[i % colors.length], stroke: null});
	        	}

				chart = anychart.column();
				
				chart.column(data);

				selected = dropdown.options[dropdown.selectedIndex].value;
				// chart.title(selected + " in Selected States");
				var x = chart.xAxis().title();
				x.enabled(true);
				x.useHtml(true);
				x.text("<a style='color:#EB8258'>States</a>");
				var y = chart.yAxis().title();
				y.enabled(true);
				y.useHtml(true);
				y.text("<a style='color:#EB8258'>" + selected + "</a>");
    			chart.background().fill(null);

				chart.container("container");
				chart.draw();
			});
	    }

	    var stand_in_dates = ["3/28", "3/29", "3/30", "3/31", "4/1", 
	    				      "4/2", "4/3", "4/4", "4/5", "4/6", 
	    				      "4/7", "4/8", "4/9", "4/10", "4/11",
	    				      "4/12", "4/13", "4/14", "4/15", "4/16",
	    				      "4/17", "4/18", "4/19", "4/20", "4/21",
	    				      "4/22", "4/23", "4/24", "4/25", "4/26"];
	    stand_in_dates = stand_in_dates.reverse();

	    function update_plot()
		{
			arr = [];
			states_arr = [];
			document.getElementById("container2").innerHTML = "";
			dropdown = document.getElementById("sort");
			selected = dropdown.options[dropdown.selectedIndex].value;
			num_checked = 0;

			for (j = 0; j < history_arr[selected]["AK"].length; j++) arr.push([stand_in_dates[j]]);

			for (i = 1; i < rows.length; i++) 
			{
				if (rows[i].getElementsByTagName("TD")[0].getElementsByTagName("input")[0].checked)
				{
					state_name = rows[i].getElementsByTagName("TD")[1].innerHTML;
					for (j = 0; j < history_arr[selected][state_name].length; j++)
					{
						arr[j].push([history_arr[selected][state_name][j]]);
					}
					states_arr.push(state_name);
					num_checked++;
				}
			}

	        anychart.onDocumentReady(function() 
	        {
			    data = anychart.data.set (arr.reverse());
				chart = anychart.line();

				for (i = 0; i < num_checked; i++)
					chart.line(data.mapAs({x: 0, value: i+1})).name(states_arr[i]).stroke(colors[i % colors.length]);

				// chart.title(selected + " in Selected States");
				var x = chart.xAxis().title();
				x.enabled(true);
				x.useHtml(true);
				x.text("<a style='color:#EB8258'>Time</a>");
				var y = chart.yAxis().title();
				y.enabled(true);
				y.useHtml(true);
				y.text("<a style='color:#EB8258'>" + selected + "</a>");
    			chart.background().fill(null);

				chart.container("container2");
				chart.draw();
			});
	    }
	

	</script>
	<script   src="https://code.jquery.com/jquery-3.4.1.js"   integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="   crossorigin="anonymous"></script>
</head>
<body onload="getData()">
	<div class="heading">
        <div>
            <header><h1>COVID-19 LIVE STATISTICS</h1></header>
        </div>    
        <div>
            <nav style="z-index: 100">
                <div class="nav">
                    <ul>                
                       <li><a class="current" href="#">Home</a></li>
					<li><a href="donations.html">Donate Masks</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>

    <script src="https://cdn.anychart.com/releases/8.0.0/js/anychart-base.min.js"></script>

    <div id="main">
    	<div class="section" id="section1">
    		<div class="headOfBox" id="headOfBox1">Select the states to compare on the graphs to the right.</br>Click the triangles to reorganize the table by category.</div>
		    <div class="box" id="box1">
	    		<span id="data"></span>
		    </div>
		</div>
		<div class="section" id="section2">
			<div class="headOfBox" id="headOfBox2">
				Compare Selected States By:&nbsp
				<form id="compareForm">
					<select id="sort" onchange="update_visuals()">
						<option>Total Positive Cases</option>
						<option>Daily Positive Case Increase</option>
						<option>Total Deaths</option>
						<option>Daily Death Increase</option>
					</select>
				</form>
			</div>
		    <div class="box" id="box2">
		    	<div class=chart id="container"></div>
				<div class=chart id="container2"></div>
		    </div>
		</div>
	</div>



<!------------------------- floating TOP button ----------------------------->
<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
<script type="text/javascript">
	
	btn_top = document.getElementById("myBtn");


	window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    btn_top.style.display = "block";
  } else {
    btn_top.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0; 
  document.documentElement.scrollTop = 0; 
}
</script>
<!--------------------- end of floating TOP button --------------------------->


<footer>
	<div>
		&copy; Team Webalubadubdub, 2020
	</div>
</footer>

</body>
</html>